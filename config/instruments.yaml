# Complete Instrument Configuration for Z1_SFC
# Defines all financial instruments, their properties, and valid combinations

instruments:
  # ==========================================
  # CATEGORIZATION BY ISSUER AUTHORITY
  # ==========================================
  
  by_issuer:
    # ------------------------------------------
    # Central Bank Only Instruments
    # ------------------------------------------
    central_bank_only:
      description: "Instruments that can only be issued by the Federal Reserve"
      instruments:
        "30130":
          name: "Depository institution reserves"
          type: "reserve"
          is_liability: false
          maturity: "overnight"
          risk_weight: 0.0
          liquidity: "high"
        "30120":
          name: "Treasury currency"
          type: "currency"
          is_liability: false
          maturity: "perpetual"
          risk_weight: 0.0
          liquidity: "high"
        "31130":
          name: "Depository institution reserves (liability)"
          type: "reserve"
          is_liability: true
          maturity: "overnight"
          risk_weight: 0.0
          liquidity: "high"
        "31120":
          name: "Treasury currency (liability)"
          type: "currency"
          is_liability: true
          maturity: "perpetual"
          risk_weight: 0.0
          liquidity: "high"
      issuers: ["71"]  # Federal Reserve only
      function: "monetary_base"
      market_clearing: true
      
    # ------------------------------------------
    # Federal Government Only
    # ------------------------------------------
    federal_govt_only:
      description: "Instruments that can only be issued by the Federal Government"
      instruments:
        "30611":
          name: "Treasury securities (asset)"
          type: "bond"
          is_liability: false
          maturity: "mixed"
          risk_weight: 0.0
          liquidity: "high"
        "31611":
          name: "Treasury securities (liability)"
          type: "bond"
          is_liability: true
          maturity: "mixed"
          risk_weight: 0.0
          liquidity: "high"
        "30613":
          name: "Nonmarketable Treasury securities (asset)"
          type: "bond"
          is_liability: false
          maturity: "long"
          risk_weight: 0.0
          liquidity: "low"
        "31613":
          name: "Nonmarketable Treasury securities (liability)"
          type: "bond"
          is_liability: true
          maturity: "long"
          risk_weight: 0.0
          liquidity: "low"
        "30614":
          name: "U.S. savings securities (asset)"
          type: "savings_bond"
          is_liability: false
          maturity: "long"
          risk_weight: 0.0
          liquidity: "low"
        "31614":
          name: "U.S. savings securities (liability)"
          type: "savings_bond"
          is_liability: true
          maturity: "long"
          risk_weight: 0.0
          liquidity: "low"
        "30615":
          name: "Budget agency securities (asset)"
          type: "agency_bond"
          is_liability: false
          maturity: "mixed"
          risk_weight: 0.0
          liquidity: "medium"
        "31615":
          name: "Budget agency securities (liability)"
          type: "agency_bond"
          is_liability: true
          maturity: "mixed"
          risk_weight: 0.0
          liquidity: "medium"
      issuers: ["31"]  # Federal government only
      function: "risk_free_assets"
      market_clearing: true
      
    # ------------------------------------------
    # State and Local Government Only
    # ------------------------------------------
    state_local_only:
      description: "Instruments that can only be issued by state and local governments"
      instruments:
        "30620":
          name: "Municipal securities (asset)"
          type: "muni_bond"
          is_liability: false
          maturity: "long"
          risk_weight: 0.2
          liquidity: "medium"
        "31620":
          name: "Municipal securities (liability)"
          type: "muni_bond"
          is_liability: true
          maturity: "long"
          risk_weight: 0.2
          liquidity: "medium"
        "30622":
          name: "Short-term municipal securities (asset)"
          type: "muni_note"
          is_liability: false
          maturity: "short"
          risk_weight: 0.2
          liquidity: "medium"
        "31622":
          name: "Short-term municipal securities (liability)"
          type: "muni_note"
          is_liability: true
          maturity: "short"
          risk_weight: 0.2
          liquidity: "medium"
        "30624":
          name: "Long-term municipal securities (asset)"
          type: "muni_bond"
          is_liability: false
          maturity: "long"
          risk_weight: 0.2
          liquidity: "low"
        "31624":
          name: "Long-term municipal securities (liability)"
          type: "muni_bond"
          is_liability: true
          maturity: "long"
          risk_weight: 0.2
          liquidity: "low"
      issuers: ["21", "22"]  # State and local governments
      function: "subnational_debt"
      market_clearing: true
      
    # ------------------------------------------
    # Depository Institutions Only
    # ------------------------------------------
    depository_only:
      description: "Instruments that can only be issued by depository institutions"
      instruments:
        "31200":
          name: "Checkable deposits and currency"
          type: "deposit"
          is_liability: true
          maturity: "demand"
          risk_weight: 0.0
          liquidity: "high"
        "30200":
          name: "Checkable deposits and currency (asset)"
          type: "deposit"
          is_liability: false
          maturity: "demand"
          risk_weight: 0.0
          liquidity: "high"
        "31300":
          name: "Time and savings deposits"
          type: "deposit"
          is_liability: true
          maturity: "short"
          risk_weight: 0.0
          liquidity: "medium"
        "30300":
          name: "Time and savings deposits (asset)"
          type: "deposit"
          is_liability: false
          maturity: "short"
          risk_weight: 0.0
          liquidity: "medium"
        "31310":
          name: "Small time and savings deposits"
          type: "deposit"
          is_liability: true
          maturity: "short"
          risk_weight: 0.0
          liquidity: "medium"
        "31320":
          name: "Large time deposits"
          type: "deposit"
          is_liability: true
          maturity: "short"
          risk_weight: 0.0
          liquidity: "low"
      issuers: ["70", "72", "73", "74"]  # All depositories
      function: "payment_system"
      market_clearing: true
      
    # ------------------------------------------
    # Corporate Issuers Only
    # ------------------------------------------
    corporate_only:
      description: "Instruments that can only be issued by corporate entities"
      instruments:
        "31641":
          name: "Corporate equities (liability)"
          type: "equity"
          is_liability: true
          maturity: "perpetual"
          risk_weight: 1.0
          liquidity: "medium"
        "30641":
          name: "Corporate equities (asset)"
          type: "equity"
          is_liability: false
          maturity: "perpetual"
          risk_weight: 1.0
          liquidity: "medium"
        "31630":
          name: "Corporate bonds"
          type: "bond"
          is_liability: true
          maturity: "long"
          risk_weight: 0.5
          liquidity: "medium"
        "30630":
          name: "Corporate bonds (asset)"
          type: "bond"
          is_liability: false
          maturity: "long"
          risk_weight: 0.5
          liquidity: "medium"
        "31691":
          name: "Commercial paper"
          type: "short_term_debt"
          is_liability: true
          maturity: "short"
          risk_weight: 0.2
          liquidity: "medium"
        "30691":
          name: "Commercial paper (asset)"
          type: "short_term_debt"
          is_liability: false
          maturity: "short"
          risk_weight: 0.2
          liquidity: "medium"
        "31693":
          name: "Bankers acceptances"
          type: "short_term_debt"
          is_liability: true
          maturity: "short"
          risk_weight: 0.2
          liquidity: "low"
      issuers: ["10", "11", "12"]  # Nonfinancial and financial corporations
      function: "corporate_finance"
      market_clearing: true
      
    # ------------------------------------------
    # Fund Shares
    # ------------------------------------------
    fund_shares:
      description: "Shares issued by investment funds"
      instruments:
        "31340":
          name: "Money market fund shares"
          type: "fund_share"
          is_liability: true
          maturity: "demand"
          risk_weight: 0.1
          liquidity: "high"
        "30340":
          name: "Money market fund shares (asset)"
          type: "fund_share"
          is_liability: false
          maturity: "demand"
          risk_weight: 0.1
          liquidity: "high"
        "31642":
          name: "Mutual fund shares"
          type: "fund_share"
          is_liability: true
          maturity: "perpetual"
          risk_weight: 0.8
          liquidity: "medium"
        "30642":
          name: "Mutual fund shares (asset)"
          type: "fund_share"
          is_liability: false
          maturity: "perpetual"
          risk_weight: 0.8
          liquidity: "medium"
        "31644":
          name: "ETF shares"
          type: "fund_share"
          is_liability: true
          maturity: "perpetual"
          risk_weight: 0.8
          liquidity: "high"
        "30644":
          name: "ETF shares (asset)"
          type: "fund_share"
          is_liability: false
          maturity: "perpetual"
          risk_weight: 0.8
          liquidity: "high"
      issuers: ["63", "65", "66", "67"]  # Various fund types
      function: "collective_investment"
      market_clearing: true
      
    # ------------------------------------------
    # Insurance and Pension
    # ------------------------------------------
    insurance_pension:
      description: "Insurance and pension related instruments"
      instruments:
        "31500":
          name: "Pension entitlements"
          type: "pension"
          is_liability: true
          maturity: "long"
          risk_weight: 0.0
          liquidity: "none"
        "30500":
          name: "Pension entitlements (asset)"
          type: "pension"
          is_liability: false
          maturity: "long"
          risk_weight: 0.0
          liquidity: "none"
        "31540":
          name: "Life insurance reserves"
          type: "insurance"
          is_liability: true
          maturity: "long"
          risk_weight: 0.0
          liquidity: "none"
        "30540":
          name: "Life insurance reserves (asset)"
          type: "insurance"
          is_liability: false
          maturity: "long"
          risk_weight: 0.0
          liquidity: "none"
        "31543":
          name: "Annuity reserves"
          type: "insurance"
          is_liability: true
          maturity: "long"
          risk_weight: 0.0
          liquidity: "none"
      issuers: ["54", "55", "59"]  # Insurance companies and pension funds
      function: "long_term_savings"
      market_clearing: true
      
    # ------------------------------------------
    # Loans
    # ------------------------------------------
    loans:
      description: "Various types of loans"
      instruments:
        "40000":
          name: "Loans (aggregate)"
          type: "loan"
          is_liability: false
          maturity: "mixed"
          risk_weight: 0.5
          liquidity: "low"
        "34000":
          name: "Loans (liability)"
          type: "loan"
          is_liability: true
          maturity: "mixed"
          risk_weight: 0.5
          liquidity: "low"
        "40100":
          name: "Consumer credit"
          type: "loan"
          is_liability: false
          maturity: "medium"
          risk_weight: 0.75
          liquidity: "low"
        "34100":
          name: "Consumer credit (liability)"
          type: "loan"
          is_liability: true
          maturity: "medium"
          risk_weight: 0.75
          liquidity: "low"
        "40200":
          name: "Bank loans n.e.c."
          type: "loan"
          is_liability: false
          maturity: "short"
          risk_weight: 0.5
          liquidity: "low"
        "40300":
          name: "Mortgages"
          type: "mortgage"
          is_liability: false
          maturity: "long"
          risk_weight: 0.35
          liquidity: "low"
        "34300":
          name: "Mortgages (liability)"
          type: "mortgage"
          is_liability: true
          maturity: "long"
          risk_weight: 0.35
          liquidity: "low"
      issuers: ["70", "72", "73", "10", "15"]  # Banks and borrowers
      function: "credit_intermediation"
      market_clearing: true

  # ==========================================
  # VALID SECTOR-INSTRUMENT COMBINATIONS
  # ==========================================
  
  valid_combinations:
    # ------------------------------------------
    # What each sector can hold as ASSETS
    # ------------------------------------------
    can_hold:
      "15":  # Households
        - "30000"  # Currency
        - "30200"  # Checkable deposits
        - "30300"  # Time deposits
        - "30340"  # Money market fund shares
        - "30641"  # Corporate equities
        - "30642"  # Mutual fund shares
        - "30611"  # Treasury securities
        - "30620"  # Municipal securities
        - "30500"  # Pension entitlements
        - "30540"  # Life insurance reserves
        
      "10":  # Nonfinancial corporate business
        - "30000"  # Currency
        - "30200"  # Checkable deposits
        - "30300"  # Time deposits
        - "30611"  # Treasury securities
        - "30641"  # Corporate equities (cross-holdings)
        - "30691"  # Commercial paper
        - "40200"  # Trade credit
        
      "31":  # Federal government
        - "30200"  # Deposits at Fed
        - "30120"  # Gold and SDRs
        - "40100"  # Student loans
        - "40200"  # Other loans
        
      "70":  # Commercial banks
        - "30130"  # Reserves at Fed
        - "30611"  # Treasury securities
        - "30620"  # Municipal securities
        - "30630"  # Corporate bonds
        - "30641"  # Corporate equities
        - "30691"  # Commercial paper
        - "40000"  # Loans (all types)
        - "40300"  # Mortgages
        
      "71":  # Federal Reserve
        - "30611"  # Treasury securities
        - "30615"  # Agency securities
        - "30630"  # Corporate bonds (crisis facilities)
        - "30691"  # Commercial paper (crisis facilities)
        - "40200"  # Loans to banks
        - "30120"  # Gold and SDRs
        
      "63":  # Money market funds
        - "30611"  # Treasury securities
        - "30691"  # Commercial paper
        - "30200"  # Bank deposits
        - "30613"  # Agency securities
        
      "65":  # Mutual funds
        - "30641"  # Corporate equities
        - "30630"  # Corporate bonds
        - "30611"  # Treasury securities
        - "30620"  # Municipal securities
        - "30644"  # ETF shares
        
      "59":  # Pension funds
        - "30641"  # Corporate equities
        - "30630"  # Corporate bonds
        - "30611"  # Treasury securities
        - "30642"  # Mutual fund shares
        - "40300"  # Mortgages
        
      "26":  # Rest of the world
        - "30611"  # Treasury securities
        - "30641"  # Corporate equities
        - "30630"  # Corporate bonds
        - "30200"  # U.S. bank deposits
        - "30691"  # Commercial paper
        
    # ------------------------------------------
    # What each sector can issue as LIABILITIES
    # ------------------------------------------
    can_issue:
      "31":  # Federal government
        - "31611"  # Treasury securities
        - "31613"  # Nonmarketable treasuries
        - "31614"  # Savings bonds
        - "31615"  # Agency securities
        
      "21":  # State and local governments
        - "31620"  # Municipal securities
        - "31622"  # Short-term munis
        - "31624"  # Long-term munis
        
      "10":  # Nonfinancial corporate business
        - "31641"  # Corporate equities
        - "31630"  # Corporate bonds
        - "31691"  # Commercial paper
        - "34000"  # Loans (borrowing)
        - "34300"  # Mortgages (commercial)
        
      "15":  # Households
        - "34100"  # Consumer credit
        - "34300"  # Home mortgages
        - "34200"  # Other loans
        
      "70":  # Commercial banks
        - "31200"  # Checkable deposits
        - "31300"  # Time and savings deposits
        - "31320"  # Large time deposits
        - "31641"  # Bank equity
        - "31630"  # Bank bonds
        - "31691"  # Bank commercial paper
        
      "71":  # Federal Reserve
        - "31130"  # Reserve balances
        - "31120"  # Currency in circulation
        
      "63":  # Money market funds
        - "31340"  # MMF shares
        
      "65":  # Mutual funds
        - "31642"  # Mutual fund shares
        
      "59":  # Pension funds
        - "31500"  # Pension entitlements
        
      "54":  # Life insurance companies
        - "31540"  # Life insurance reserves
        - "31543"  # Annuity reserves

  # ==========================================
  # INSTRUMENT PROPERTIES
  # ==========================================
  
  properties:
    # ------------------------------------------
    # Zero-sum instruments
    # ------------------------------------------
    zero_sum:
      description: "Instruments where global assets must equal global liabilities"
      instruments:
        - "31200"  # Checkable deposits
        - "31300"  # Time and savings deposits
        - "31641"  # Corporate equities
        - "31630"  # Corporate bonds
        - "31611"  # Treasury securities
        - "31620"  # Municipal securities
        - "31340"  # MMF shares
        - "31642"  # Mutual fund shares
        - "31500"  # Pension entitlements
        - "31540"  # Life insurance reserves
        - "31691"  # Commercial paper
        - "40000"  # Loans
        - "40300"  # Mortgages
      enforcement: "hard"
      tolerance: 1.0e-10
      
    # ------------------------------------------
    # Non-zero-sum instruments
    # ------------------------------------------
    non_zero_sum:
      description: "Instruments that can have net positive or negative amounts"
      instruments:
        - "30000"  # Currency (net asset for private sector)
        - "30130"  # Reserves (net asset for banks)
        - "90000"  # Net worth
        - "80000"  # Miscellaneous
      enforcement: "none"
      
    # ------------------------------------------
    # Special handling instruments
    # ------------------------------------------
    special_handling:
      "30130":  # Reserves at Fed
        constraint: "must_equal_fed_liability"
        counterpart: "31130"
        tolerance: 1.0e-12
        
      "30120":  # Treasury currency
        constraint: "must_equal_treasury_liability"
        counterpart: "31120"
        tolerance: 1.0e-12
        
      "31641":  # Corporate equities
        constraint: "market_value_adjustment"
        revaluation_series: "FR.*31641.*"
        tolerance: 1.0e-6
        
      "31500":  # Pension entitlements
        constraint: "actuarial_consistency"
        formula_series: "FL.*31500.*"
        tolerance: 1.0e-8
        
      "40300":  # Mortgages
        constraint: "sectoral_balance"
        holder_sectors: ["70", "54", "59", "65"]
        issuer_sectors: ["15", "10", "11"]
        tolerance: 1.0e-8

  # ==========================================
  # AGGREGATION HIERARCHIES
  # ==========================================
  
  aggregation:
    # ------------------------------------------
    # Asset categories
    # ------------------------------------------
    financial_assets:
      code: "90000"
      components:
        - liquid_assets:
            code: "90100"
            components:
              - "30000"  # Currency
              - "30200"  # Checkable deposits
              - "30300"  # Time deposits
              - "30340"  # MMF shares
        - debt_securities:
            code: "90200"
            components:
              - "30611"  # Treasuries
              - "30620"  # Munis
              - "30630"  # Corporate bonds
              - "30691"  # Commercial paper
        - equity_securities:
            code: "90300"
            components:
              - "30641"  # Corporate equities
              - "30642"  # Mutual fund shares
              - "30644"  # ETF shares
        - loans_and_mortgages:
            code: "90400"
            components:
              - "40000"  # Loans
              - "40300"  # Mortgages
              
    # ------------------------------------------
    # Liability categories
    # ------------------------------------------
    financial_liabilities:
      code: "95000"
      components:
        - deposits:
            code: "95100"
            components:
              - "31200"  # Checkable
              - "31300"  # Time and savings
              - "31320"  # Large time
        - debt_securities_issued:
            code: "95200"
            components:
              - "31611"  # Treasuries (if govt)
              - "31620"  # Munis (if state/local)
              - "31630"  # Corporate bonds
              - "31691"  # Commercial paper
        - loans_borrowed:
            code: "95300"
            components:
              - "34000"  # Loans
              - "34100"  # Consumer credit
              - "34300"  # Mortgages

  # ==========================================
  # MAPPING TO Z1 SERIES
  # ==========================================
  
  z1_mapping:
    # Pattern to identify instrument from Z1 series code
    # Z1 format: PP SS IIIII C .F
    # PP = prefix (FL, FU, FR, FV)
    # SS = sector (2 digits)
    # IIIII = instrument (5 digits)
    # C = calculation type (0,1,3,5,6)
    # F = frequency (Q or A)
    
    patterns:
      currency: "F[LU]\\d{2}30000[0-9]\\.Q"
      checkable_deposits: "F[LU]\\d{2}3(0|1)200[0-9]\\.Q"
      time_deposits: "F[LU]\\d{2}3(0|1)300[0-9]\\.Q"
      treasuries: "F[LU]\\d{2}3(0|1)611[0-9]\\.Q"
      munis: "F[LU]\\d{2}3(0|1)62[0-9][0-9]\\.Q"
      corporate_bonds: "F[LU]\\d{2}3(0|1)630[0-9]\\.Q"
      corporate_equities: "F[LU]\\d{2}3(0|1)641[0-9]\\.Q"
      commercial_paper: "F[LU]\\d{2}3(0|1)691[0-9]\\.Q"
      loans: "F[LU]\\d{2}(3|4)4[0-9]{3}[0-9]\\.Q"
      mortgages: "F[LU]\\d{2}(3|4)4300[0-9]\\.Q"
      mmf_shares: "F[LU]\\d{2}3(0|1)340[0-9]\\.Q"
      mutual_fund_shares: "F[LU]\\d{2}3(0|1)642[0-9]\\.Q"
      pension_entitlements: "F[LU]\\d{2}3(0|1)500[0-9]\\.Q"
      insurance_reserves: "F[LU]\\d{2}3(0|1)54[0-9][0-9]\\.Q"

  # ==========================================
  # VALIDATION RULES
  # ==========================================
  
  validation:
    # Rules for data quality checks
    rules:
      - name: "deposits_positive"
        description: "Deposits should be non-negative"
        instruments: ["31200", "31300"]
        condition: "value >= 0"
        severity: "error"
        
      - name: "equity_consistency"
        description: "Equity assets and liabilities should balance globally"
        asset_instruments: ["30641"]
        liability_instruments: ["31641"]
        condition: "sum(assets) == sum(liabilities)"
        tolerance: 1.0e-6
        severity: "warning"
        
      - name: "reserve_balance"
        description: "Bank reserves must equal Fed liabilities"
        asset_instruments: ["30130"]
        liability_instruments: ["31130"]
        condition: "sum(assets) == sum(liabilities)"
        tolerance: 1.0e-10
        severity: "error"
        
      - name: "loan_symmetry"
        description: "Loans made should equal loans taken"
        asset_pattern: "40.*"
        liability_pattern: "34.*"
        condition: "category_sum(assets) == category_sum(liabilities)"
        tolerance: 1.0e-8
        severity: "warning"
